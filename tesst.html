<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>eCommerce Store</title>
   <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
   </head>

     <body>

        <div class="container">

        <nav class = "navbar navbar-expand-lg navbar-light bg-light sticky=top">
         <a href="index.html" class="navbar-brand">Shop</a>
         <a href="cart.html" class="navbar-brand"> <ion-icon name= "basket"></ion-icon> Cart<span>0</span></a>
       </nav>
         <header class="jumbotron m-0">
           <h1>Camera</h1>
           <img src="https://user.oc-static.com/upload/2019/12/12/1576141243078_Orinoco%20logo.png">
           <!--img scr "http/-->
         </header>

           <main class="row m-0 card">

           </main>
           <section id ="orderSection">
          <br><br>
       
            
           <div class="table-responsive">
          <table class="table table-striped table-hover">
            <h2 class="text-center"><ins>ITEM</ins> In Your Card</h2>
                         
            <thead>
              <tr>
                <th>Name</th>
                <th>Lense</th>
                <th>Price</th>
              </tr>
             </div>
           </thead>
          </table>
          </section>

          <h2 class="text-center">Submit Order</h2>

          <form class="card p-5">
            <div class="form-row">
             <div class="form-group col-md-6">
             <label for="forename">Forename</label> 
             <input type="text" class="form-control" id="forename"
             placeholder="Forename">
            <small class="text-danger d-none" id="forenameErrror" >Inavlid Input></small>
            </div>
          </div>
          </form> 

           
              <form class="card p-5">
               <div class="form-row">
                <div class="form-group col-md-6">
                <label for="surname">Surname</label> 
                <input type="text" class="form-control" id="surname"
                placeholder="Surname">
               <small class="text-danger d-none" id="surnameErrror" >Inavlid Input</small>
               </div>
              </div>
          </form> 

               

          
               
             <form class="card p-5">
               <div class="form-row">
                <div class="form-group col-md-6">
                <label for="email">Email</label> 
                <input type="text" class="form-control" id="email"
                placeholder="Email">
               <small class="text-dander d-none" id="emailErrror" >inavlid Input</small>
               </div>
              </div>
              </form>
            
                  
             <form class="card p-5">
               <div class="form-row">
                <div class="form-group col-md-6">
                <label for="address">Address</label> 
                <input type="text" class="form-control" id="address"
                placeholder="Address">
               <small class="text-danger d-none" id="addressErrror" >Inavlid Input</small>
               </div>
              </div>
               
             </form>
            



               <form class="card p-5">
                <div class="form-row">
                  <div class="form-group col-md-6">
                 <label for="city">City</label> 
                 <input type="text" class="form-control" id="city"
                 placeholder="City">
                <small class="text-danger d-none" id="cityErrror" >Inavlid <input type="text"></small>
                </div>
                </div>

                <button class="btn"><i class="fa fa-lock"></i>Submit <a href="cart.js"></a></button>
              
     
                </form>
             
               <!--<button class="btn"><i class="fa fa-lock"></i>Submit <a href="cart.nj"></a></button>-->
                        
            



                    <footer class ="bg-light">
                         <p class="text-center p-3">Ray Ash 2020</p> 
                    </footer>
          
                
                 <script src="cart.js"></script>
                <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
            </div>
    
   </body>
</html>




 btn.addEventListener("click",  function (ev) {
    alert("YOUR CURRENT ITEM ADDED TO CART")
     console.log(currItem);
     let cartlength = cart.cartlength
     for (let i=0; i < cartlength; i++)  {
         if (currItem.name === cart[i].name)  {

         }
     }
   cart.push(currItem);
   
   localStorage.setItem("cart" , JSON.stringify(cart));
   cart = localStorage.getItem("cart");
   console.log(cart);
 

  
    });
    
    
}


 btn.addEventListener("click",  function (ev) {
    alert("YOUR CURRENT ITEM ADDED TO CART")
     console.log(currItem);
     let cartlength = cart.cartlength
     for (let i=0; i < cartlength; i++)  {
         if (currItem.name === cart[i].name)  {

         }
     }

   setItem(currItem);

   cart.push(currItem);


  function setItem(currItem) {
    let cart = localStorage.getItem("cart");
    localStorage = JSON.stringify(cart);
      console.log(cart);

   if(cart != null) {
       cart[currItem.name].qty += 1;
   }else {
       currItem.qty = 1;
       cart = {
           [currItem.qty]: currItem,
       }
   }
 
     localStorage.setItem("cart" , JSON.stringify(cart));

  }
    });
    
    
}


-----------------------------------------------------------------------------
btn.addEventListener("click",  function (ev) {
  alert("YOUR CURRENT ITEM ADDED TO CART")
  console.log(currItem);
  let cartlength = cart.cartlength

  for (let i=0; i < cartlength; i++)  {
      if (currItem.name === cart[i].name)  {
          if(currItem.lenses === cart[i].lenses) {
              cart[i].qty += 1 
          } else if(currItem.lenses !== cart[i].lenses) {
              cart.push(currItem)
          }
          
      } else if(currItem.name !== cart[i].name) {
          cart.push(currItem)
      }
       
  } 

  
   

  

 localStorage.setItem("cart" , JSON.stringify(cart));
 cart = localStorage.getItem("cart");
 console.log(cart);

  


});

  
  
}

btn.addEventListener("click",  function (ev) {
  alert("YOUR CURRENT ITEM ADDED TO CART")
  console.log(currItem);
  let cartlength = cart.cartlength

  for (let i=0; i < cartlength; i++)  {
      if (currItem.name === cart[i].name)  {
          if(currItem.lenses === cart[i].lenses) {
              cart[i].qty += 1 
          } else if(currItem.lenses !== cart[i].lenses) {
              cart.push(currItem)
          }
          
      } else if(currItem.name !== cart[i].name) {
          cart.push(currItem)
          
      }
       
  } 
----------------------------------------------------------------------------------------------------------------------------------------------------
//functio for API///
//console.log("running")
const products = document.getElementById('products');
let currItem = {

    'name': '',
    'price': 0,
    'lenses':'',
    'qty' : 0,
};
let cartString = localStorage.getItem("cart") || '[]';
console.log(cartString);
let cart = JSON.parse(cartString);
console.log(cart);

makeRequest = () => {
    return new Promise((resolve, reject) => {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const id = urlParams.get('id');
        
       let apiRequest = new XMLHttpRequest();
       apiRequest.open('GET' , 'http://Localhost:3000/api/cameras/' + id);
       apiRequest.send();
       apiRequest.onreadystatechange = () => {
        if (apiRequest.readyState === 4) { 
            if (apiRequest.status === 200) {

         resolve(JSON.parse(apiRequest.response));
        } else{
            reject('Something went wrong - API resquest Faild ');
        }
      }
     }
    });
}

//================== Creat Elements =========================
createCard = (response) => {
    console.log(response);
    const card = document.createElement('Article');
    console.log(response.imageUrl);
    const img = response.imageUrl;
    const newImg = document.createElement('IMG');
    const btn = document.createElement('button');
    const form = document.createElement('form');
    const main = document.createElement('main');
    const dropMenuLabel = document.createElement('Label');
    const dropMenu = document.createElement('select');
    const newP = document.createElement('p');

    card.appendChild(main);
    
    
    newImg.classList.add('img');
    newImg.setAttribute('width' ,'100%');
    newImg.setAttribute('src' , img) ;
    card.appendChild(newImg);

   card.classList.add('col', 'card', 'p-3');
   card.innerHTML += '<h2>' + response.name + '</h2>';
   currItem.name = response.name  
   dropMenuLabel.innerHTML = 'Choose you lense here &nbsp;&nbsp;&nbsp;';
   form.appendChild(dropMenuLabel);
   form.appendChild(dropMenu);


   for (let x in response.lenses) {
    const option = document.createElement('option');
    option.innerHTML = response.lenses[x];
    option.setAttribute('value' , response.lenses[x])
    dropMenu.appendChild(option);
    option.addEventListener("change", function(ev) {
        //currItem.lenses = 
        console.log(ev.target);
    });
   }
    card.appendChild(form);
    currItem.lenses = response.lenses[0];

    card.innerHTML += '<p>' +response.description +'</p>';
    card.innerHTML += '<p>' + '$' + response.price / 100 + '</p>';
    currItem.price = response.price;
    currItem.qty = 1;
     console.log("line80",currItem);
    btn.classList.add('btn','btn-secondary','w-25' , 'mx-auto');
    btn.innerHTML = 'Add to Card';
    newP.classList.add('text-center' , 'text-success');
    newP.innerHTML += '<p>' + response + '</p>';
    products.appendChild(card);
    card.appendChild(btn);

    ///NEW CODE BY REZA"""""

/////////////////   BTN Event Listener   /////////////////////




btn.addEventListener("click",  function (ev) {
  alert("YOUR CURRENT ITEM ADDED TO CART")
  console.log(currItem);
  let cartlength = cart.cartlength;
  if (cartlength === 0) {
      cart.push(currItem)
  } else {
    for (let i=0; i < cartlength; i++)  {
      if (currItem.name === cart[i].name && currItem.lenses === cart[i].lenses) {
         cart[i].qty += 1;
      } else if (currItem.name === cart[i].name && currItem.lenses !== cart[i].lenses)
       cart.push(currItem);               
    }
  }
        
  
    cart.push(currItem);
    localStorage.setItem("cart" , JSON.stringify(cart));
    cart = localStorage.getItem("cart");
    console.log(cart);

});
}


   init = async () => {
        try{
            const requestPromise = makeRequest();
            const response = await requestPromise;

            createCard(response);
        } catch (error) {
            document.querySelector('main').innerHTML = '<h2 class = "mx-auto">' + error + '</h2>';
        }
        }
    
     init()
       
    
  
     
     
     
     <ion-icon name ="close-circle"></ion-icon>




     /////////   Get Data From LocalStorage///////////// 

let cartItems = localStorage.getItem("cart");
cartItems = JSON.parse(cartItems);
console.log(cartItems)

///////////////Display Item in Cart ////////////////

function displayCart(){
    
    let productContainer = document.querySelector(".products");
    let cartCostN = localStorage.getItem('totalCost');
    
      
    console.log("here is" , cartCostN);
    console.log(cartItems);
    if(cartItems && productContainer) {
        console.log("running")
        productContainer.innerHTML = '';
        Object.values(cartItems).map(item => {
            productContainer.innerHTML += `
           <div class ="product">
                          
              <div class="product-title">${item.name}</div>
              <div class="lens">${item.lenses}</div>
              <div class="price">$${item.price}</div>
           <button class="remove" data-name="${item.name}" data-lens="${item.lenses}">Remove</button>
              
           </div>
            
          `
      ////////////OnClick Remove Bottom/////////////
          
             productContainer.onclick = function(e) {
             console.log("clicked List")
             console.log(e.target)
             const lens = e.target.dataset.lens
             const name = e.target.dataset.name

             
            // Update TotalCost///////////////////
              
             cartCostN = parseInt(cartCostN);
             localStorage.setItem("totalCost" , cartCostN - item.price );
             console.log(cartCostN - item.price);

            ///////Remove Item/////////////////////

             console.log(cartItems);
             removeItem(e,name,lens);
                                                             
              return
             }
           });
     
     
//////////////////////Remove Item/////////////////////////////////
        
        function removeItem(e,name,lens) {
                         
               //need to delete item from cart//
        for (let i = 0; i <cartItems.length; i++) {
          if (cartItems[i].name === name && cartItems[i].lenses === lens) {
           console.log(cartItems[i].name);
           cartItems.splice(i, 1);
           console.log(cartItems);
          }
        }
          //remove node from page
          e.target.parentElement.remove();
         
          //get cart sync in local storage
          localStorage.setItem("cart" , JSON.stringify(cartItems));
          cartItems = JSON.parse(localStorage.getItem("cart"));
           
        }
      
        productContainer.innerHTML += `

        <div class="basketTotalContainer">

        <h5 class="basketTotalTitle">
             Basket Total
        </h5>
        
        <h5 class="basketTotal">
            $${cartCostN}
       </h5>     
     `  
    };
   }
  
  displayCart();
      
///////////////////////////// Create Contacts/////////////////////////////

  const fname = document.getElementById('fname');
  const lastname = document.getElementById('lastname');
  const email = document.getElementById('email');  
  const address = document.getElementById('address'); 
  const errorElement = document.getElementById('error');
  const form = document.getElementById('form');

///////////////////////////  Form Validation  /////////////////////////////
    
  form.addEventListener('submit', (e) => {
        
    let messages = [];

    if (fname.value === '' || fname.value == null) {
        messages.push('Warning : Name is Required');
    }
    if(lastname.value === '' || lastname.value == null) {
       messages.push('Lastname is required')
    }
    if(address.value === '' || address.value == null) {
        messages.push('Address is required')
    }
    if(email.value === '' || email.value == null) {
      messages.push('Email is required')
    }
    if (messages.length > 0) {
      e.preventDefault()
      errorElement.innerText = messages.join(', ')
    }
     e.preventDefault();

      const  postRequestObj = {
        contact: {
          fnmae:'fname.value',
          lastname: 'lastname.value',
          address: 'address.value',
          email: 'email.value',
       },
       cartItems: [
        '_id1','_id2'
       ],
      };
       /////////////// Submit Form Data and send POST request to Server////////
   
     postRequestObj = (data) => {
        return new Promise((resolve, reject) => {
            let apiRequest = new XMLHttpRequest();
            apiRequest.open('post' ,'http://localhost:3000/api/cameras/order');
            apiRequest.setRequestHeader('Content-Type', 'application/json');
            apiRequest.send(JSON.stringify(data));
            apiRequest.onreadystatechange = () => {
                if (apiRequest.readyStatus === 4) {
                    if (apiRequest.status === 201) {
                        resolve(JSON.parse(apiRequest.response));
                    }
                    if (apiRequest.status === 400) {
                        reject(" Something Went Wrong -- API Request Failed!!")
                    
                    }
                 }
              };
           });
         }
     });
     
 

     /////////////// Submit Form Data and send POST request to Server////////
     
                  

     fetch('http://localhost:3000/api/cameras/order', {
      method: 'POST',
      headers: {
          'Content-Type': 'application/json',
      },
      body: JSON.stringify(postRequestObj),
      })
      .then(response => response.json())
      .then(postRequestObj => {
        console.log('Success:', postRequestObj);
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    });
  /////////////////////////////////////// 
    fetch('/confirm.html', Options, {
      method: 'POST',
     // cache: 'no-cache',
     /// mode: 'no-cors',
      headers: {
          'Content-Type': 'application/json',
     },
      body: JSON.stringify(postRequestObj),
     })
     .then(response => response.json())
      .then(response => {
       console.log('Success:', postRequestObj);
     })
      .catch((error) => {
        console.error('Error:', error);
 });/////////End Response

   


});   

fetch('http://localhost:3000/api/cameras/order', {
      
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
    },
     body: JSON.stringify(postRequestObj)
     })
    .then(res => {
     return res.json()
     
    })
    .then(postMessage  => 
     console.log('Success:', postRequestObj))
   
    .catch((error) =>
     console.error('Error:' , error));
//////

fetch('http://localhost:3000/api/cameras/order', {
      
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
    },
     body: JSON.stringify(postRequestObj)
     })
    .then(res => {
     return res.json()
     
    })
    .then(_postMessage  => 
     console.log('Success:', postRequestObj))
   
    .catch((error) =>
     console.error('Error:' , error));
     ///////////////////////////////////////////////

     async function postData(url = 'http://127.0.0.1:5500/confirm.html', data = { contact: {

      fnmae:fname.value,
      lastname: lastname.value,
      address: address.value,
      city: city.value,
      email: email.value,
    },
      cartItems: cartIds, 
     })
    {
     const res = await fetch('http://localhost:3000/api/cameras/order', {
        method: 'POST', 
       ///mode: 'no-cors', 
        headers: {
          'Content-Type': 'application/json'
        
        },
       ///redirect: 'follow', 
      ///  referrerPolicy: 'no-referrer', 
        body: JSON.stringify(data) 
      });
      return res.json(); // parses JSON response into native JavaScript objects
    }
    
    postData('http://127.0.0.1:5500/confirm.html', { answer: 42 })
      .then(data => {
        console.log(data); // JSON data parsed by `data.json()` call
      });
   /////////////////////////////
   
   fetch('http://localhost:3000/api/cameras', {
      
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
    },
     body: JSON.stringify({postRequestObj})
          
     })
     
    .catch(response=> response.body.json())
    .catch(myJson=> console.log(myJson))
    .then(data  => 
     console.log('Success:', postRequestObj))
    /// document.querySelector('#app').innerHTML =
    // `<p> Thank you !!!Your information Successfully added </p>`
    .catch((error) =>
     
    
    
    console.error('Error:' , error)); 


<!------------------------------Cart Html-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>eCommerce Store</title>
   <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
   </head>
     <body>
        <div class="container">

       <nav class = "navbar navbar-expand-lg navbar-light bg-light sticky=top">
         <a href="index.html" class="navbar-brand">Shop</a>
         <a href="cart.html" class="navbar-brand"> <ion-icon name= "basket"></ion-icon> Cart</a>
       </nav>

         <header class="jumbotron m-0">
           <h1>Camera</h1>
           <img src="https://user.oc-static.com/upload/2019/12/12/1576141243078_Orinoco%20logo.png">
           <!--img scr "http/-->
           <div class="index__footer">
            <a href="index.html" class="index__link">Back</a>
           </div>
         </header>
           
      
         <main class="row m-0 card">
          <div class="table-responsive">
            <table class="table table-striped table-hover"></table>
              <h2 class="text-center"><ins>ITEM</ins> In Your Cart</h2>
          <div class= "products-container">
          <div class= "product-header">
             <h5 class="product-title">Product:</h5>
             <h5 class="lens">Lens:</h5>
             <h5 class="price">Price:</h5>
          </div>
              
          <div class="products">
                 
          </div>
          </div>                
                
          <section id="orderSection">
           <br><br>
           <div id= "Tprice"></div>
             <h2 class="text-center">Submit Order</h2>

           <div id="error"></div> 
           
         <form id="form" action="/confirm.html" method="POST">

             <div class="form-row">
             <div class="col">

              <label for="fname"><strong>First Name</strong></label>
              <input id="fname" name="fname" type="text" placeholder="First Name" required >

            
              <label for="lastname"><strong>Last Name</strong></label >
              <input id="lastname" name="lastname" type="text" placeholder="Last Name" required>
            
            
              <label for="address"><strong>Address</strong></label >
              <input id="address" name="address" type="text" placeholder="Address" required>

              <label for="city"><strong>City</strong></label >
                <input id="city" name="city" type="text" placeholder="City" required>
  
            
            
              <label for="email"><strong>Email</strong></label>
              <input id="email" name="email" type="email" placeholder="Email" required>
         
              <button id="btn" type="submit"><strong>Submit</strong></button>

          </form>



          <footer class ="bg-light">
            <p class="text-center p-3">Ray Ash 2020</p> 
          </footer>
          
          </main>
          </section>
         </div>
        </div>
       </div>
      <script src="cart.js"></script>
     <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
   </body>
 </html>













 

 <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>eCommerce Store</title>
   <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
   </head>
     <body>
        <div class="container">

       <nav class = "navbar navbar-expand-lg navbar-light bg-light sticky=top">
         <a href="index.html" class="navbar-brand">Shop</a>
         <a href="cart.html" class="navbar-brand"> <ion-icon name= "basket"></ion-icon> Cart</a>
       </nav>

         <header class="jumbotron m-0">
           <h1>Camera</h1>
           <img src="https://user.oc-static.com/upload/2019/12/12/1576141243078_Orinoco%20logo.png">
           <!--img scr "http/-->
           <div class="index__footer">
            <a href="index.html" class="index__link">Back</a>
           </div>
         </header>

           <!-----!---------Products ----------------------------->
      
   <main class="row m-0 card">
     <div class="table-responsive">
        <table class="table table-striped table-hover"></table>
          <p class="note">Your product</p>
           <div class= "products-container">
            <div class= "product-header">
              <h5 class="product-title">Product:</h5>
              <h5 class="lens">Lens:</h5>
              <h5 class="price">Price:</h5>
            </div>
              
               <div class="products">
                
             </div>
          </div>                
                
    <section id="orderSection">
      <br><br>
        <div id= "Tprice"></div>
           <div id="error"></div> 

           <!-----!------------Form Elements---------------------------------->
           <!-----!---------- Lablel , Validations---------------------------->

 <div class="container register-form">
    <div class="form">
       <div class="note">
            <p>Submit Order</p>
       </div>
   <form id="form" action="/confirm.html" method="POST">
     <div class="form-content">
       <div class="row">
         <div class="col-md-6">
           <div class="form-group">
               <label for="fname"><strong>First Name</strong></label>
               <input id="fname" name="fname" type="text" 
                class="form-control" placeholder="First Name " value="" required/>
           </div>
            <div class="form-group">
               <label for="lastname"><strong>Last Name</strong></label >
               <input id="lastname" name="lastname" type="text"
               class="form-control" placeholder="Last Name " value="" required/>
           </div>
           </div>
           <div class="col-md-6">
             <div class="form-group">
                <label for="address"><strong>Address</strong></label >
                <input id="address" name="address" type="text"
                class="form-control" placeholder="Address" value="" required/>
           </div>
           <div class="form-group">
                <label for="city"><strong>City</strong></label >
                <input  id="city" name="city" type="text"
               class="form-control" placeholder=" City" value="" required/>
           </div>
           </div>
           <div class="col-md-6">
             <div class="form-group">
               <label for="email"><strong>Email</strong></label>
               <input id="email" name="email" type="text" 
               class="form-control" placeholder="Email" value="" required/>
            </div>
            </div>
              </div>
               <button id="btn" class="btnSubmit" type="submit">
                 <strong>Submit</strong></button>
              </div>
            </div>
          </div>
       </form>

    <!-----!-------------Footer---------------------------->

            <footer class ="bg-light">
              <p class="text-center p-3">Ray Ash 2020</p> 
            </footer>     

    <!-----!----------End Footrt---------------------------->         
            
      </main>
     </section>
    </div>
           <script src="cart.js"></script>
           <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
  </body>
 </html>


 ///////   Get Data From LocalStorage///////////// 

let cartItems = localStorage.getItem("cart");
cartItems = JSON.parse(cartItems);
console.log(cartItems)

///////////////Display Item in Cart  And Map To Product////////////////

function displayCart(){
    
    let productContainer = document.querySelector(".products");
    let cartCostN  = localStorage.getItem('totalCost');
    
    console.log("here is" , cartCostN /100);
    console.log(cartItems);
    if(cartItems && productContainer) {
      
      console.log("running")
      productContainer.innerHTML = '';
      Object.values(cartItems).map(item => {
      productContainer.innerHTML += `
      <div class ="product">
      <div class="product-title">${item.name}</div>
      <div class="lens">${item.lenses}</div>
      <div class="price">$${item.price}</div>
      <button class="remove" data-name="${item.name}"
      data-lens="${item.lenses}">Remove</button>
      </div>
      `
               
      ////////////OnClick Remove Bottom/////////////
            
      productContainer.onclick = function(e) {
        
      console.log("clicked List")
      console.log(e.target)
      const lens = e.target.dataset.lens
      const name = e.target.dataset.name
      


      /////////////// Update TotalCost///////////////////
       
      location.reload();
      cartCostN  = parseInt(cartCostN);
      localStorage.setItem("totalCost" , cartCostN - item.price) ;
            location.reload();
      
      
      ///////////////////Remove Item/////////////////////

      console.log(cartItems);
      removeItem(e,name,lens);
      return
    }
    
   });
       
   
//////////////////////Remove Item/////////////////////////////////
        
    function removeItem(e,name,lens) {
      
      //////////////need to delete item from cart/////////
     for (let i = 0; i <cartItems.length; i++) {
        if (cartItems[i].name === name && cartItems[i].lenses === lens )  {
          console.log(cartItems[i].name);
          cartItems.splice(i, 1);
          console.log(cartItems);
        }
    }
   ////////////////remove node from page////////////////////////////
     e.target.parentElement.remove();
   /////////// //get cart sync in local storage/////////////////////

     localStorage.setItem("cart" , JSON.stringify(cartItems));
     cartItems = JSON.parse(localStorage.getItem("cart"));
     
    }

 
   //////////////// Map Total Basket ///////////////////////////////   
  
   productContainer.innerHTML += `
   <div class="basketTotalContainer">
    <h5 class="basketTotalTitle">
         Basket Total
    </h5>
     <h5 class="basketTotal">
         $${cartCostN }
     </h5>   
   </div>   
   `
    };
    
  }
 ////// Function display : Void///////////////////////////////////////////

  displayCart();
      
///////////////////////////// Create Contacts/////////////////////////////
  
  const fname = document.getElementById('fname');
  const lastname = document.getElementById('lastname');
  const email = document.getElementById('email');  
  const address = document.getElementById('address'); 
  const city = document.getElementById('city');
  const errorElement = document.getElementById('error');
  const form = document.getElementById('form');
   
///////////////////////////  Form Validation  /////////////////////////////
    
  form.addEventListener('submit', (e) => {
        
    let messages = [];

    if (fname.value === '' || fname.value == null) {
        messages.push('Warning : Name is Required');
    }
    if(lastname.value === '' || lastname.value == null) {
       messages.push('Lastname is required')
    }
    if(address.value === '' || address.value == null) {
        messages.push('Address is required')
    }
    if(city.value === '' || city.value == null) {
      messages.push('City is required')
    }
    if(email.value === '' || email.value == null) {
      messages.push('Email is required')
    }
    if (messages.length > 0) {
      e.preventDefault()
      errorElement.innerText = messages.join(', ')
    }
     e.preventDefault();

       // ************************************************************************
      // ******************* stuff I added **************************************
      // ************************************************************************
      function getIds() {
        let idArray = [];
        for(let i=0; i <cartItems.length; i++) {
          idArray.push(cartItems[i].id);
          console.log(idArray);
          
        };
        return idArray
      };
      
      let cartIds = getIds();
      console.log(cartIds);
     // ************************************************************************
                  ////Create posstOpject Request//////////////
     // ************************************************************************
      const  postRequestObj = {
      contact: {
          firstName:fname.value,
          lastName: lastname.value,
          address: address.value,
          city: city.value,
          email: email.value,
        },
     products: cartIds
    }
      ////////////////// Submit Form Data and "Fetch" send "POST" request to "Server"////////
    fetch('http://localhost:3000/api/cameras/order', {
      
      method: 'POST',
      headers: {
        'Content-Type': 'application/json', 
         'Accept': 'application/json'
    },
     body: JSON.stringify(postRequestObj)
    })
      .then(response => response.json())
      .then(data  => {
       console.log(data);
       console.log('Success:', postRequestObj);
       window.location.href = 'confirm.html';
       localStorage.setItem('MyOrderId' , JSON.stringify(data));
       
    })
       .catch((error) => console.error('Error:' , error));
    });
   
    
    //////////functio for API//////////////////////////////////////////
    ///////////////console.log("running")////////////////////////////////
    
    const products = document.getElementById('products');
    let currItem = {
    
        'name': '',
        'price': 0,
        'lenses':'',
        'qty' : 1,
        'id' : ''
    }; 
    
    let cartString = localStorage.getItem("cart") || '[]';
    console.log(cartString);
    let cart = JSON.parse(cartString);
    console.log(cart);
    
    ////////////////////////////////Make Request ////////////////////////
       
    makeRequest = () => {
        return new Promise((resolve, reject) => {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const id = urlParams.get('id');
            
           let apiRequest = new XMLHttpRequest();
           apiRequest.open('GET' , 'http://Localhost:3000/api/cameras/' + id);
           apiRequest.send();
           apiRequest.onreadystatechange = () => {
            if (apiRequest.readyState === 4) { 
                if (apiRequest.status === 200) {
    
             resolve(JSON.parse(apiRequest.response));
            } else{
                reject('Something went wrong - API resquest Faild ');
            }
          }
         }
      });
    }
    
    //================== Create Elements ================================
    
    createCard = (response) => {
        console.log(response);
        const card = document.createElement('Article');
        console.log(response.imageUrl);
        const img = response.imageUrl;
        const newImg = document.createElement('IMG');
        const btn = document.createElement('button');
        const form = document.createElement('form');
        const main = document.createElement('main');
        const dropMenuLabel = document.createElement('Label');
        const dropMenu = document.createElement('select');
        const newP = document.createElement('p');
        
        newImg.classList.add('img');
        newImg.setAttribute('width' ,'100%');
        newImg.setAttribute('src' , img) ;
        card.appendChild(newImg);
        
    
        card.classList.add('col', 'card', 'p-3');
        card.innerHTML += '<h2>' + response.name + '</h2>';
        currItem.name = response.name  
        currItem.id = response._id
        dropMenuLabel.innerHTML = 'Choose you lense here &nbsp;&nbsp;&nbsp;';
        dropMenu.classList.add('drop-menu');
        document.querySelectorAll('.drop-menu')
        dropMenu.addEventListener('change' , changeLens);
        function changeLens(ev) {
            console.log(ev.target.value);
            currItem.lenses = ev.target.value;
        }
        form.appendChild(dropMenuLabel);
        form.appendChild(dropMenu);
           
          for (let x in response.lenses) {
          const option = document.createElement('option');
          option.innerHTML = response.lenses[x];
          option.setAttribute('value' , response.lenses[x])
          dropMenu.appendChild(option);
        }
        
        currItem.lenses = response.lenses[0];
         
         
        card.innerHTML += '<p>' +response.description +'</p>';
        card.innerHTML += '<p>' + '$' + response.price / 100 + '</p>';
        card.appendChild(form);
        currItem.price = response.price / 100;
        currItem.qty = 1
    
        btn.classList.add('btn','btn-secondary','w-25' , 'mx-auto');
        btn.innerHTML = 'Add to Card';
        newP.classList.add('text-center' , 'text-success');
        newP.innerHTML += '<p>' + response + '</p>';
        products.appendChild(card);
        card.appendChild(btn);
        card.appendChild(main);
        
                   
      /////////////////   BTN Event Listener   /////////////////////
    
        btn.addEventListener('click' , (ev) => {
            
            document.querySelector("#app").innerHTML =
         `<p> Thank you !!!Your Product Successfully added ${currItem.name},${currItem.lenses} </p>`
                ////alert(' !!! Your Current Item Added Successfully');
            totalCost(currItem);          
            console.log('currItem' , currItem);
            let quantChange = false;
            if (cart.length === 0 ) {
                cart.push(currItem);
                quantChange = true;
            
            } else  { 
                for(i=0; i < cart.length; i++){
                    if (currItem.name === cart[i].name && currItem.lenses === cart[i].lenses) {
                        cart[i].qty += 1
                        quantChange = true;
                   
                    } 
                }
            }
    
            if (!quantChange) {
                cart.push(currItem);
            }
            localStorage.setItem("cart" , JSON.stringify(cart));
            cart = JSON.parse(localStorage.getItem("cart"));
            console.log(cart);
            
            quantChange = false;
            currItem.qty = 1;
            
        });
           
       ///////////////////// Total Cost ///////////////////////
       
      function totalCost(currItem) {
         console.log("the product price is ,product.price");
          let cartCost  = localStorage.getItem('totalCost');
         console.log("my cartCost is" , cartCost / 100);
          console.log(typeof cartCost );
     
          if (cartCost != null) {
               cartCost = parseInt(cartCost);
                
               localStorage.setItem("totalCost" , cartCost + currItem.price);
               
           } else {
               localStorage.setItem("totalCost", currItem.price);
          };
        };
              
     }///////////closed Respons createCard////////////////
    
       
       init = async () => {
            try{
                const requestPromise = makeRequest();
                const response = await requestPromise;
    
                createCard(response);
            } catch (error) {
                document.querySelector('main').innerHTML = '<h2 class = "mx-auto">' + error + '</h2>';
            }
            }
        
         init()
           