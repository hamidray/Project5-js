<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>eCommerce Store</title>
   <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link href="https://unpkg.com/ionicons@4.5.10-0/dist/css/ionicons.min.css" rel="stylesheet">
   </head>

     <body>

        <div class="container">

        <nav class = "navbar navbar-expand-lg navbar-light bg-light sticky=top">
         <a href="index.html" class="navbar-brand">Shop</a>
         <a href="cart.html" class="navbar-brand"> <ion-icon name= "basket"></ion-icon> Cart<span>0</span></a>
       </nav>
         <header class="jumbotron m-0">
           <h1>Camera</h1>
           <img src="https://user.oc-static.com/upload/2019/12/12/1576141243078_Orinoco%20logo.png">
           <!--img scr "http/-->
         </header>

           <main class="row m-0 card">

           </main>
           <section id ="orderSection">
          <br><br>
       
            
           <div class="table-responsive">
          <table class="table table-striped table-hover">
            <h2 class="text-center"><ins>ITEM</ins> In Your Card</h2>
                         
            <thead>
              <tr>
                <th>Name</th>
                <th>Lense</th>
                <th>Price</th>
              </tr>
             </div>
           </thead>
          </table>
          </section>

          <h2 class="text-center">Submit Order</h2>

          <form class="card p-5">
            <div class="form-row">
             <div class="form-group col-md-6">
             <label for="forename">Forename</label> 
             <input type="text" class="form-control" id="forename"
             placeholder="Forename">
            <small class="text-danger d-none" id="forenameErrror" >Inavlid Input></small>
            </div>
          </div>
          </form> 

           
              <form class="card p-5">
               <div class="form-row">
                <div class="form-group col-md-6">
                <label for="surname">Surname</label> 
                <input type="text" class="form-control" id="surname"
                placeholder="Surname">
               <small class="text-danger d-none" id="surnameErrror" >Inavlid Input</small>
               </div>
              </div>
          </form> 

               

          
               
             <form class="card p-5">
               <div class="form-row">
                <div class="form-group col-md-6">
                <label for="email">Email</label> 
                <input type="text" class="form-control" id="email"
                placeholder="Email">
               <small class="text-dander d-none" id="emailErrror" >inavlid Input</small>
               </div>
              </div>
              </form>
            
                  
             <form class="card p-5">
               <div class="form-row">
                <div class="form-group col-md-6">
                <label for="address">Address</label> 
                <input type="text" class="form-control" id="address"
                placeholder="Address">
               <small class="text-danger d-none" id="addressErrror" >Inavlid Input</small>
               </div>
              </div>
               
             </form>
            



               <form class="card p-5">
                <div class="form-row">
                  <div class="form-group col-md-6">
                 <label for="city">City</label> 
                 <input type="text" class="form-control" id="city"
                 placeholder="City">
                <small class="text-danger d-none" id="cityErrror" >Inavlid <input type="text"></small>
                </div>
                </div>

                <button class="btn"><i class="fa fa-lock"></i>Submit <a href="cart.js"></a></button>
              
     
                </form>
             
               <!--<button class="btn"><i class="fa fa-lock"></i>Submit <a href="cart.nj"></a></button>-->
                        
            



                    <footer class ="bg-light">
                         <p class="text-center p-3">Ray Ash 2020</p> 
                    </footer>
          
                
                 <script src="cart.js"></script>
                <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
            </div>
    
   </body>
</html>




 btn.addEventListener("click",  function (ev) {
    alert("YOUR CURRENT ITEM ADDED TO CART")
     console.log(currItem);
     let cartlength = cart.cartlength
     for (let i=0; i < cartlength; i++)  {
         if (currItem.name === cart[i].name)  {

         }
     }
   cart.push(currItem);
   
   localStorage.setItem("cart" , JSON.stringify(cart));
   cart = localStorage.getItem("cart");
   console.log(cart);
 

  
    });
    
    
}


 btn.addEventListener("click",  function (ev) {
    alert("YOUR CURRENT ITEM ADDED TO CART")
     console.log(currItem);
     let cartlength = cart.cartlength
     for (let i=0; i < cartlength; i++)  {
         if (currItem.name === cart[i].name)  {

         }
     }

   setItem(currItem);

   cart.push(currItem);


  function setItem(currItem) {
    let cart = localStorage.getItem("cart");
    localStorage = JSON.stringify(cart);
      console.log(cart);

   if(cart != null) {
       cart[currItem.name].qty += 1;
   }else {
       currItem.qty = 1;
       cart = {
           [currItem.qty]: currItem,
       }
   }
 
     localStorage.setItem("cart" , JSON.stringify(cart));

  }
    });
    
    
}


-----------------------------------------------------------------------------
btn.addEventListener("click",  function (ev) {
  alert("YOUR CURRENT ITEM ADDED TO CART")
  console.log(currItem);
  let cartlength = cart.cartlength

  for (let i=0; i < cartlength; i++)  {
      if (currItem.name === cart[i].name)  {
          if(currItem.lenses === cart[i].lenses) {
              cart[i].qty += 1 
          } else if(currItem.lenses !== cart[i].lenses) {
              cart.push(currItem)
          }
          
      } else if(currItem.name !== cart[i].name) {
          cart.push(currItem)
      }
       
  } 

  
   

  

 localStorage.setItem("cart" , JSON.stringify(cart));
 cart = localStorage.getItem("cart");
 console.log(cart);

  


});

  
  
}

btn.addEventListener("click",  function (ev) {
  alert("YOUR CURRENT ITEM ADDED TO CART")
  console.log(currItem);
  let cartlength = cart.cartlength

  for (let i=0; i < cartlength; i++)  {
      if (currItem.name === cart[i].name)  {
          if(currItem.lenses === cart[i].lenses) {
              cart[i].qty += 1 
          } else if(currItem.lenses !== cart[i].lenses) {
              cart.push(currItem)
          }
          
      } else if(currItem.name !== cart[i].name) {
          cart.push(currItem)
          
      }
       
  } 
----------------------------------------------------------------------------------------------------------------------------------------------------
//functio for API///
//console.log("running")
const products = document.getElementById('products');
let currItem = {

    'name': '',
    'price': 0,
    'lenses':'',
    'qty' : 0,
};
let cartString = localStorage.getItem("cart") || '[]';
console.log(cartString);
let cart = JSON.parse(cartString);
console.log(cart);

makeRequest = () => {
    return new Promise((resolve, reject) => {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const id = urlParams.get('id');
        
       let apiRequest = new XMLHttpRequest();
       apiRequest.open('GET' , 'http://Localhost:3000/api/cameras/' + id);
       apiRequest.send();
       apiRequest.onreadystatechange = () => {
        if (apiRequest.readyState === 4) { 
            if (apiRequest.status === 200) {

         resolve(JSON.parse(apiRequest.response));
        } else{
            reject('Something went wrong - API resquest Faild ');
        }
      }
     }
    });
}

//================== Creat Elements =========================
createCard = (response) => {
    console.log(response);
    const card = document.createElement('Article');
    console.log(response.imageUrl);
    const img = response.imageUrl;
    const newImg = document.createElement('IMG');
    const btn = document.createElement('button');
    const form = document.createElement('form');
    const main = document.createElement('main');
    const dropMenuLabel = document.createElement('Label');
    const dropMenu = document.createElement('select');
    const newP = document.createElement('p');

    card.appendChild(main);
    
    
    newImg.classList.add('img');
    newImg.setAttribute('width' ,'100%');
    newImg.setAttribute('src' , img) ;
    card.appendChild(newImg);

   card.classList.add('col', 'card', 'p-3');
   card.innerHTML += '<h2>' + response.name + '</h2>';
   currItem.name = response.name  
   dropMenuLabel.innerHTML = 'Choose you lense here &nbsp;&nbsp;&nbsp;';
   form.appendChild(dropMenuLabel);
   form.appendChild(dropMenu);


   for (let x in response.lenses) {
    const option = document.createElement('option');
    option.innerHTML = response.lenses[x];
    option.setAttribute('value' , response.lenses[x])
    dropMenu.appendChild(option);
    option.addEventListener("change", function(ev) {
        //currItem.lenses = 
        console.log(ev.target);
    });
   }
    card.appendChild(form);
    currItem.lenses = response.lenses[0];

    card.innerHTML += '<p>' +response.description +'</p>';
    card.innerHTML += '<p>' + '$' + response.price / 100 + '</p>';
    currItem.price = response.price;
    currItem.qty = 1;
     console.log("line80",currItem);
    btn.classList.add('btn','btn-secondary','w-25' , 'mx-auto');
    btn.innerHTML = 'Add to Card';
    newP.classList.add('text-center' , 'text-success');
    newP.innerHTML += '<p>' + response + '</p>';
    products.appendChild(card);
    card.appendChild(btn);

    ///NEW CODE BY REZA"""""

/////////////////   BTN Event Listener   /////////////////////




btn.addEventListener("click",  function (ev) {
  alert("YOUR CURRENT ITEM ADDED TO CART")
  console.log(currItem);
  let cartlength = cart.cartlength;
  if (cartlength === 0) {
      cart.push(currItem)
  } else {
    for (let i=0; i < cartlength; i++)  {
      if (currItem.name === cart[i].name && currItem.lenses === cart[i].lenses) {
         cart[i].qty += 1;
      } else if (currItem.name === cart[i].name && currItem.lenses !== cart[i].lenses)
       cart.push(currItem);               
    }
  }
        
  
    cart.push(currItem);
    localStorage.setItem("cart" , JSON.stringify(cart));
    cart = localStorage.getItem("cart");
    console.log(cart);

});
}


   init = async () => {
        try{
            const requestPromise = makeRequest();
            const response = await requestPromise;

            createCard(response);
        } catch (error) {
            document.querySelector('main').innerHTML = '<h2 class = "mx-auto">' + error + '</h2>';
        }
        }
    
     init()
       
    
  
     <ion-icon name ="close-circle"></ion-icon>